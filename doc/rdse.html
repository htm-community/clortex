<html><head><meta content="chrome=1" http-equiv="X-UA-Compatible" /><meta charset="utf-8" /><meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport" /><title>Random Distributed Scalar Encoder</title><style>body {
  padding:50px;
  font:14px/1.5 Helvetica, Arial, sans-serif;
  color:#777;
  font-weight:300;
}

h1, h2, h3, h4, h5, h6 {
  color:#222;
  margin:0 0 20px;
}

p, ul, ol, table, pre, dl {
  margin:0 0 20px;
}

h1, h2, h3 {
  line-height:1.1;
}

h1 {
  font-size:28px;
}

h2 {
  color:#393939;
}

h4, h5, h6 {
  color:#494949;
  margin:0;
}

header h4{
  margin: 10 0 0 0px;
}

a {
  color:#39c;
  font-weight:400;
  text-decoration:none;
}

a small {
  font-size:11px;
  color:#777;
  margin-top:-0.6em;
  display:block;
}

.wrapper {
  width:860px;
  margin:0 auto;
}

.figure div.img {
  text-align: center;
  border-radius: 5px;
  border: 1px solid #ddd;
  padding: 10px;
}

blockquote {
  border-left:1px solid #e5e5e5;
  margin:0;
  padding:0 0 0 20px;
  font-style:italic;
}

code, pre {
  font-family:Monaco, Bitstream Vera Sans Mono, Lucida Console, Terminal;
  color:#333;
  font-size:12px;
}

pre {
  padding:8px 15px;
  background: #f8f8f8;  
  border-radius:5px;
  border:1px solid #e5e5e5;
  overflow-x: auto;
}

table {
  width:100%;
  border-collapse:collapse;
}

th, td {
  text-align:left;
  padding:5px 10px;
  border-bottom:1px solid #e5e5e5;
}

dt {
  color:#444;
  font-weight:700;
}

th {
  color:#444;
}

img {
  max-width:100%;
}

header {
  width:270px;
  float:left;
  /*position:fixed;*/
}

header ul {
  list-style:none;
  height:40px;
  
  padding:0;
  
  background: #eee;
  background: -moz-linear-gradient(top, #f8f8f8 0%, #dddddd 100%);
  background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#f8f8f8), color-stop(100%,#dddddd));
  background: -webkit-linear-gradient(top, #f8f8f8 0%,#dddddd 100%);
  background: -o-linear-gradient(top, #f8f8f8 0%,#dddddd 100%);
  background: -ms-linear-gradient(top, #f8f8f8 0%,#dddddd 100%);
  background: linear-gradient(top, #f8f8f8 0%,#dddddd 100%);
  
  border-radius:5px;
  border:1px solid #d2d2d2;
  box-shadow:inset #fff 0 1px 0, inset rgba(0,0,0,0.03) 0 -1px 0;
  width:270px;
}

header li {
  width:89px;
  float:left;
  border-right:1px solid #d2d2d2;
  height:40px;
}

header ul a {
  line-height:1;
  font-size:11px;
  color:#999;
  display:block;
  text-align:center;
  padding-top:6px;
  height:40px;
}

strong {
  font-weight:700;
}

header ul li + li {
  width:88px;
  border-left:1px solid #fff;
}

header ul li + li + li {
  border-right:none;
  width:89px;
}

header ul a strong {
  font-size:14px;
  display:block;
  color:#222;
}

section {
  width: 60%;
  float:right;
  padding-bottom:50px;
  padding-right: 10%;
}

small {
  font-size:11px;
}

hr {
  border:0;
  background:#e5e5e5;
  height:1px;
  margin:0 0 20px;
}

footer {
  width:270px;
  float:left;
  position:fixed;
  bottom:50px;
}

header div.heading {
  display:none;
}


@media print, screen and (max-width: 960px) {
  
  div.wrapper {
    width:auto;
    margin:0;
  }
  
  header, section, footer {
    float:none;
    position:static;
    width:auto;
  }
  
  header div.heading {
    display:block;
  }
    
  section div.heading {
    display:none;
  }
  
  section {
    border:1px solid #e5e5e5;
    border-width:1px 0;
    padding:20px 0;
    margin:0 0 20px;
  }
  
  header a small {
    display:inline;
  }
  
  header ul {
    position:absolute;
    right:50px;
    top:52px;
  }
}

@media print, screen and (max-width: 720px) {
  body {
    word-wrap:break-word;
  }
  
  header {
    padding:0;
  }
  
  header ul, header p.view {
    position:static;
  }
  
  pre, code {
    word-wrap:normal;
  }
}

@media print, screen and (max-width: 480px) {
  body {
    padding:15px;
  }
  
  header ul {
    display:none;
  }
}

@media print {
  body {
    padding:0.4in;
    font-size:12pt;
    color:#444;
  }
}


.highlight  { background: #ffffff; }
.highlight .c { color: #999988; font-style: italic } /* Comment */
.highlight .err { color: #a61717; background-color: #e3d2d2 } /* Error */
.highlight .k { font-weight: bold } /* Keyword */
.highlight .o { font-weight: bold } /* Operator */
.highlight .cm { color: #999988; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #999999; font-weight: bold } /* Comment.Preproc */
.highlight .c1 { color: #999988; font-style: italic } /* Comment.Single */
.highlight .cs { color: #999999; font-weight: bold; font-style: italic } /* Comment.Special */
.highlight .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.highlight .gd .x { color: #000000; background-color: #ffaaaa } /* Generic.Deleted.Specific */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #aa0000 } /* Generic.Error */
.highlight .gh { color: #999999 } /* Generic.Heading */
.highlight .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.highlight .gi .x { color: #000000; background-color: #aaffaa } /* Generic.Inserted.Specific */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #555555 } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold; } /* Generic.Subheading */
.highlight .gt { color: #aa0000 } /* Generic.Traceback */
.highlight .kc { font-weight: bold } /* Keyword.Constant */
.highlight .kd { font-weight: bold } /* Keyword.Declaration */
.highlight .kn { font-weight: bold } /* Keyword.Namespace */
.highlight .kp { font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #445588; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #009999 } /* Literal.Number */
.highlight .s { color: #d14 } /* Literal.String */
.highlight .na { color: #008080 } /* Name.Attribute */
.highlight .nb { color: #0086B3 } /* Name.Builtin */
.highlight .nc { color: #445588; font-weight: bold } /* Name.Class */
.highlight .no { color: #008080 } /* Name.Constant */
.highlight .ni { color: #800080 } /* Name.Entity */
.highlight .ne { color: #990000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #990000; font-weight: bold } /* Name.Function */
.highlight .nn { color: #555555 } /* Name.Namespace */
.highlight .nt { color: #000080 } /* Name.Tag */
.highlight .nv { color: #008080 } /* Name.Variable */
.highlight .ow { font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #009999 } /* Literal.Number.Float */
.highlight .mh { color: #009999 } /* Literal.Number.Hex */
.highlight .mi { color: #009999 } /* Literal.Number.Integer */
.highlight .mo { color: #009999 } /* Literal.Number.Oct */
.highlight .sb { color: #d14 } /* Literal.String.Backtick */
.highlight .sc { color: #d14 } /* Literal.String.Char */
.highlight .sd { color: #d14 } /* Literal.String.Doc */
.highlight .s2 { color: #d14 } /* Literal.String.Double */
.highlight .se { color: #d14 } /* Literal.String.Escape */
.highlight .sh { color: #d14 } /* Literal.String.Heredoc */
.highlight .si { color: #d14 } /* Literal.String.Interpol */
.highlight .sx { color: #d14 } /* Literal.String.Other */
.highlight .sr { color: #009926 } /* Literal.String.Regex */
.highlight .s1 { color: #d14 } /* Literal.String.Single */
.highlight .ss { color: #990073 } /* Literal.String.Symbol */
.highlight .bp { color: #999999 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #008080 } /* Name.Variable.Class */
.highlight .vg { color: #008080 } /* Name.Variable.Global */
.highlight .vi { color: #008080 } /* Name.Variable.Instance */
.highlight .il { color: #009999 } /* Literal.Number.Integer.Long */

.type-csharp .highlight .k { color: #0000FF }
.type-csharp .highlight .kt { color: #0000FF }
.type-csharp .highlight .nf { color: #000000; font-weight: normal }
.type-csharp .highlight .nc { color: #2B91AF }
.type-csharp .highlight .nn { color: #000000 }
.type-csharp .highlight .s { color: #A31515 }
.type-csharp .highlight .sc { color: #A31515 }


</style></head><body><header><div class="heading"><h1>Random Distributed Scalar Encoder</h1><h3>Experiments on improving the Scalar Encoder</h3><hr /><div class="info"><h5>Author: Fergal Byrne<b>&nbsp;&nbsp;<a href="mailto:fergalbyrnedublin@gmail.com">(fergalbyrnedublin@gmail.com)</a></b></h5><h5>Library: v0.1.1-SNAPSHOT</h5><h5>Date: 16 February 2014</h5><h5>Website: <a href="https://github.com/fergalbyrne/clortex">https://github.com/fergalbyrne/clortex</a></h5><h5>Generated By: <a href="http://www.github.com/zcaudate/lein-midje-doc">MidjeDoc</a></h5></div><br /><hr /></div><h4><a href="#background">1 &nbsp; Background</a></h4><h5>&nbsp;&nbsp;<i><a href="#the-current-scalar-encoder">1.1 &nbsp; The Current Scalar Encoder</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#the-random-distributed-scalar-encoder">1.2 &nbsp; The Random Distributed Scalar Encoder</a></i></h5><br /></header><section><div class="heading"><h1>Random Distributed Scalar Encoder</h1><h3>Experiments on improving the Scalar Encoder</h3><hr /><div class="info"><h5>Author: Fergal Byrne<b>&nbsp;&nbsp;<a href="mailto:fergalbyrnedublin@gmail.com">(fergalbyrnedublin@gmail.com)</a></b></h5><h5>Library: v0.1.1-SNAPSHOT</h5><h5>Date: 16 February 2014</h5><h5>Website: <a href="https://github.com/fergalbyrne/clortex">https://github.com/fergalbyrne/clortex</a></h5><h5>Generated By: <a href="http://www.github.com/zcaudate/lein-midje-doc">MidjeDoc</a></h5></div><br /><hr /></div><div><a name="background"></a><h2><b>1 &nbsp;&nbsp; Background</b></h2></div><div><p>Chetan Surpur gave a great talk on a new version of the Scalar Encoder for NuPIC  (<a href='http://www.youtube.com/watch?v=&#95;q5W2Ov6C9E'>video</a>). This document explores the  implications of the new design and makes some recommendations about further improvements.</p><p>A <strong>Scalar Encoder</strong> is a function which converts a scalar value <code>v</code> into a bit map <code>sdr</code>  with a given number <code>bits</code> of possible bits, of which <code>width</code> bits are 1 and the rest are 0. One important property of the SDRs is that values close together share many more bits than values further apart.</p><p>Here's a simple example:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="k">def </span><span class="nv">enc</span> <span class="p">(</span><span class="nf">scalar-encoder</span> <span class="ss">:bits</span> <span class="mi">12</span> <span class="ss">:on</span> <span class="mi">4</span> <span class="ss">:min</span><span class="o">&#39;</span> <span class="mi">1</span> <span class="ss">:max</span><span class="o">&#39;</span> <span class="mi">12</span><span class="p">))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">to-bitstring</span> <span class="p">(</span><span class="ss">:encode-to-bitstring</span> <span class="nv">enc</span><span class="p">))</span>

<span class="p">(</span><span class="nf">vec</span> <span class="p">(</span><span class="nb">map </span><span class="nv">to-bitstring</span> <span class="p">(</span><span class="nb">range </span><span class="mi">1</span> <span class="mi">13</span><span class="p">)))</span>

<span class="nv">=&gt;</span> <span class="p">[</span><span class="s">&quot;111100000000&quot;</span> 
    <span class="s">&quot;011110000000&quot;</span> 
    <span class="s">&quot;001111000000&quot;</span> 
    <span class="s">&quot;000111100000&quot;</span> 
    <span class="s">&quot;000111100000&quot;</span> 
    <span class="s">&quot;000011110000&quot;</span> 
    <span class="s">&quot;000001111000&quot;</span> 
    <span class="s">&quot;000000111100&quot;</span> 
    <span class="s">&quot;000000111100&quot;</span> 
    <span class="s">&quot;000000011110&quot;</span> 
    <span class="s">&quot;000000001111&quot;</span> 
    <span class="s">&quot;000000001111&quot;</span><span class="p">]</span>
</pre></div>
</div><div><a name="the-current-scalar-encoder"></a><h3>1.1 &nbsp;&nbsp; The Current Scalar Encoder</h3></div><div><p>The current scalar encoder (see example above) represents each scalar using a sliding window of <code>on</code> 1's. The current scalar encoder has the benefit of being instantly understandable (once you see an  example like the one in the first section) and visually decodable by the user. It does, however, have  a number of limitations.</p><p>The encoder is given a <code>min</code> and <code>max</code> when defined and it clamps its output when given values outside its initial range.  <br /></p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">to-bitstring</span> <span class="mi">-20</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">&quot;111100000000&quot;</span>
<span class="p">(</span><span class="nf">to-bitstring</span> <span class="mi">20</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">&quot;000000001111&quot;</span>
</pre></div>
</div><div><p>This means that the above two values come to represent many values, and the region receiving the encoding will not be able to discriminate between these values.</p><p>The second limitation is that the encoding is very inefficient in its use of available bits.  The number of possible <code>on</code>-bits out of <code>bits</code> bits is given by the <code>binomial</code> coefficient:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nf">binomial</span> <span class="mi">12</span> <span class="mi">4</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">495</span>
</pre></div>
</div><div><p>which is significantly larger than the number of distinct SDRs produced by the <code>scalar-encoder</code>:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">set </span><span class="p">(</span><span class="nb">map </span><span class="nv">to-bitstring</span> <span class="p">(</span><span class="nb">range </span><span class="mi">-100</span> <span class="mi">100</span><span class="p">))))</span> <span class="nv">=&gt;</span> <span class="mi">9</span>
</pre></div>
</div><div><p>This encoder is only using 1.8% of the SDRs available. Perhaps this is an extreme example because of the very small number of bits. Let's check the numbers for a more typical encoder:</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="k">def </span><span class="nv">enc</span> <span class="p">(</span><span class="nf">scalar-encoder</span> <span class="ss">:bits</span> <span class="mi">512</span> <span class="ss">:on</span> <span class="mi">21</span> <span class="ss">:min</span><span class="o">&#39;</span> <span class="mi">1</span> <span class="ss">:max</span><span class="o">&#39;</span> <span class="mi">512</span><span class="p">))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">to-bitstring</span> <span class="p">(</span><span class="ss">:encode-to-bitstring</span> <span class="nv">enc</span><span class="p">))</span>
<span class="p">(</span><span class="nb">str </span><span class="p">(</span><span class="nf">binomial</span> <span class="mi">512</span> <span class="mi">21</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="s">&quot;10133758886507113849867996785041062400&quot;</span>
<span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">set </span><span class="p">(</span><span class="nb">map </span><span class="nv">to-bitstring</span> <span class="p">(</span><span class="nb">range </span><span class="mi">-100</span> <span class="mi">1000</span><span class="p">))))</span> <span class="nv">=&gt;</span> <span class="mi">492</span>
</pre></div>
</div><div><p>Oh dear.</p></div><div><a name="the-random-distributed-scalar-encoder"></a><h3>1.2 &nbsp;&nbsp; The Random Distributed Scalar Encoder</h3></div><div><p>Chetan's talk explains a new approach. The idea is to use a set of 'buckets' to represent a set of intervals in the encoders range, and to encode each one using a randomly chosen set of <code>on</code> bits. The property of semantic closeness is achieved by only changing one bit at a time when choosing the  bits for the next bucket along.</p><p>Let's implement an RDSE. We'll need a utility function so we always get the same SDRs.</p></div><div><div class="highlight"><pre><span class="p">(</span><span class="k">def </span><span class="nv">randomer</span> <span class="p">(</span><span class="nf">random-fn-with-seed</span> <span class="mi">123456</span><span class="p">))</span> <span class="c1">; returns the same sequence of random numbers</span>
<span class="p">(</span><span class="nf">randomer</span> <span class="mi">10</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">3</span>
<span class="p">(</span><span class="nf">randomer</span> <span class="mi">10</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="mi">7</span>
</pre></div>
</div><div><p>First, </p></div><div><div class="highlight"><pre><span class="p">(</span><span class="k">def </span><span class="nv">encoder</span> <span class="p">(</span><span class="nf">random-sdr-encoder-1</span> <span class="ss">:diameter</span> <span class="mf">1.0</span> <span class="ss">:bits</span> <span class="mi">12</span> <span class="ss">:on</span> <span class="mi">4</span><span class="p">))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">buckets</span> <span class="p">(</span><span class="ss">:buckets</span> <span class="nv">encoder</span><span class="p">))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">to-bitstring</span> <span class="p">(</span><span class="ss">:encode-to-bitstring!</span> <span class="nv">encoder</span><span class="p">))</span>

<span class="p">(</span><span class="nf">to-bitstring</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">&quot;111100000000&quot;</span>

<span class="p">(</span><span class="nf">vec</span> <span class="p">(</span><span class="nb">map </span><span class="nv">to-bitstring</span> <span class="p">(</span><span class="nb">range </span><span class="mi">-5</span> <span class="mi">22</span><span class="p">)))</span> 
<span class="nv">=&gt;</span> <span class="p">[</span><span class="s">&quot;100011000001&quot;</span> 
    <span class="s">&quot;100001001001&quot;</span> 
    <span class="s">&quot;100001100001&quot;</span> 
    <span class="s">&quot;100001010001&quot;</span> 
    <span class="s">&quot;100100010001&quot;</span> 
    <span class="s">&quot;110100000001&quot;</span> 
    <span class="s">&quot;111100000000&quot;</span> 
    <span class="s">&quot;101100000010&quot;</span> 
    <span class="s">&quot;100100000110&quot;</span> 
    <span class="s">&quot;100100100010&quot;</span> 
    <span class="s">&quot;100100010010&quot;</span> 
    <span class="s">&quot;100000010011&quot;</span> 
    <span class="s">&quot;100000001011&quot;</span> 
    <span class="s">&quot;100000000111&quot;</span> 
    <span class="s">&quot;100000100101&quot;</span> 
    <span class="s">&quot;100010100100&quot;</span> 
    <span class="s">&quot;100001100100&quot;</span> 
    <span class="s">&quot;110001100000&quot;</span> 
    <span class="s">&quot;100001110000&quot;</span> 
    <span class="s">&quot;100001011000&quot;</span> 
    <span class="s">&quot;100100011000&quot;</span> 
    <span class="s">&quot;100100010010&quot;</span> 
    <span class="s">&quot;110100000010&quot;</span> 
    <span class="s">&quot;110100000100&quot;</span> 
    <span class="s">&quot;110110000000&quot;</span> 
    <span class="s">&quot;110100100000&quot;</span> 
    <span class="s">&quot;111000100000&quot;</span><span class="p">]</span>
<span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">set </span><span class="p">(</span><span class="nb">map </span><span class="nv">to-bitstring</span> <span class="p">(</span><span class="nb">range </span><span class="mi">-50</span> <span class="mi">50</span><span class="p">))))</span> <span class="nv">=&gt;</span> <span class="mi">78</span>

<span class="p">(</span><span class="k">def </span><span class="nv">encoder</span> <span class="p">(</span><span class="nf">random-sdr-encoder-1</span> <span class="ss">:diameter</span> <span class="mf">1.0</span> <span class="ss">:bits</span> <span class="mi">128</span> <span class="ss">:on</span> <span class="mi">21</span><span class="p">))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">buckets</span> <span class="p">(</span><span class="ss">:buckets</span> <span class="nv">encoder</span><span class="p">))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">to-bitstring</span> <span class="p">(</span><span class="ss">:encode-to-bitstring!</span> <span class="nv">encoder</span><span class="p">))</span>
<span class="p">(</span><span class="nb">str </span><span class="p">(</span><span class="nf">binomial</span> <span class="mi">512</span> <span class="mi">21</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="s">&quot;10133758886507113849867996785041062400&quot;</span>
<span class="p">(</span><span class="nf">to-bitstring</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">&quot;11111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;</span>
<span class="p">(</span><span class="nf">to-bitstring</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">&quot;11110111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000&quot;</span>

<span class="p">(</span><span class="k">def </span><span class="nv">n</span> <span class="mi">10000</span><span class="p">)</span> 
<span class="p">(</span><span class="nf">to-bitstring</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">&quot;10000000001010001100000000000100000000000010000011000000101010000000000000011100000001000110010000000000000000010000000000010000&quot;</span>
<span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nb">time </span><span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">set </span><span class="p">(</span><span class="nb">map </span><span class="nv">to-bitstring</span> <span class="p">(</span><span class="nb">range </span><span class="nv">n</span><span class="p">))))))</span>
<span class="c1">; &quot;Elapsed time: 34176.316 msecs&quot;</span>
<span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">set </span><span class="p">(</span><span class="nb">map </span><span class="nv">to-bitstring</span> <span class="p">(</span><span class="nb">range </span><span class="nv">n</span><span class="p">))))</span> <span class="nv">=&gt;</span> <span class="nv">n</span>
<span class="c1">;(count (set (map to-bitstring (range 20000)))) =&gt; 20000</span>

<span class="p">(</span><span class="k">def </span><span class="nv">encoder</span> <span class="p">(</span><span class="nf">random-sdr-encoder-1</span> <span class="ss">:diameter</span> <span class="mf">1.0</span> <span class="ss">:bits</span> <span class="mi">64</span> <span class="ss">:on</span> <span class="mi">21</span><span class="p">))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">buckets</span> <span class="p">(</span><span class="ss">:buckets</span> <span class="nv">encoder</span><span class="p">))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">to-bitstring</span> <span class="p">(</span><span class="ss">:encode-to-bitstring!</span> <span class="nv">encoder</span><span class="p">))</span>
<span class="p">(</span><span class="nb">str </span><span class="p">(</span><span class="nf">binomial</span> <span class="mi">64</span> <span class="mi">21</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="s">&quot;41107996877935680&quot;</span>
<span class="p">(</span><span class="nf">to-bitstring</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">&quot;1111111111111111111110000000000000000000000000000000000000000000&quot;</span>
<span class="p">(</span><span class="nf">to-bitstring</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">&quot;1111011111111111111110000000000000000010000000000000000000000000&quot;</span>

<span class="p">(</span><span class="k">def </span><span class="nv">n</span> <span class="mi">1000</span><span class="p">)</span> 
<span class="p">(</span><span class="nf">to-bitstring</span> <span class="p">(</span><span class="nb">dec </span><span class="nv">n</span><span class="p">))</span> <span class="nv">=&gt;</span> <span class="s">&quot;1010100100000010010000100001000000001000000110000011110001111101&quot;</span>
<span class="p">(</span><span class="nf">to-bitstring</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">=&gt;</span> <span class="s">&quot;1000100100000010010000100001000000001000001110000011110001111101&quot;</span>
<span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nb">time </span><span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">set </span><span class="p">(</span><span class="nb">map </span><span class="nv">to-bitstring</span> <span class="p">(</span><span class="nb">range </span><span class="nv">n</span><span class="p">))))))</span>
<span class="c1">; &quot;Elapsed time: 644.477 msecs&quot;</span>
<span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">set </span><span class="p">(</span><span class="nb">map </span><span class="nv">to-bitstring</span> <span class="p">(</span><span class="nb">range </span><span class="nv">n</span><span class="p">))))</span> <span class="nv">=&gt;</span> <span class="nv">n</span>
<span class="c1">;(count (set (map to-bitstring (range 20000)))) =&gt; 20000</span>
</pre></div>
</div><div></div></section></body><script type="text/javascript">var metas = document.getElementsByTagName('meta');
var i;
if (navigator.userAgent.match(/iPhone/i)) {
  for (i=0; i<metas.length; i++) {
    if (metas[i].name == "viewport") {
      metas[i].content = "width=device-width, minimum-scale=1.0, maximum-scale=1.0";
    }
  }
  document.addEventListener("gesturestart", gestureStart, false);
}
function gestureStart() {
  for (i=0; i<metas.length; i++) {
    if (metas[i].name == "viewport") {
      metas[i].content = "width=device-width, minimum-scale=0.25, maximum-scale=1.6";
    }
  }
}</script><script>var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-31320512-2']);
        _gaq.push(['_trackPageview']);

        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();</script></html>